{"componentChunkName":"component---src-templates-single-post-js","path":"/blog/ideas/wordpress-dynamic-ip/","result":{"data":{"site":{"siteMetadata":{"title":"Larqqa's blogfolio"}},"markdownRemark":{"id":"2864fb23-ad96-58f8-b338-cc50d8caabb2","excerpt":"Virtual machines (VMs) are a major tool in the modern development game. I wanted to start using Vagrant for managing my Wordpress development VMs. However, Iâ€¦","html":"<p>Virtual machines (VMs) are a major tool in the modern development game. I wanted to start using Vagrant for managing my Wordpress development VMs. However, I ran into a problem with the dynamic IP addresses that Vagrant uses by default. Your Wordpress website relies on a static URL, which is the servers IP if you don't have a domain setup. Putting a dynamic IP and a static URL together spells a lot of extra work every time the IP address changes. This would mean either editing the database, or the Wordpress configuration by hand.</p>\n<p>One option would be to set up a static IP address for the VM itself. This is a solid option if you are working in a single network that doesn't change, for example at home. If however you need to move to a different network to continue working on the site, like going from your home to your workplace, this option is not perfect. Your static IP might not work anymore because of conflicting network configurations like different IP ranges, or the IP might already be reserved for other devices.</p>\n<h3>The Dynamic IP configuration</h3>\n<p>To fix this problem, I started searching for a way to make the URL of Wordpress dynamic. You could make the URL <code class=\"language-text\">http://localhost</code>, but then you run into problems accessing it from the servers network facing IP, which would let you for example view the site with your mobile device.</p>\n<p>I stumbled upon <a href=\"https://wordpress.stackexchange.com/questions/179559/relative-or-dynamic-site-url-possible\">this snippet</a> that you can add to your <code class=\"language-text\">wp-config.php</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Get server ip address and folder path</span>\r\n<span class=\"token variable\">$currenthost</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'http://'</span><span class=\"token operator\">.</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SERVER_ADDR'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token variable\">$currentpath</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'@/+$@'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SCRIPT_NAME'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token variable\">$currentpath</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\/wp.+/'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$currentpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token variable\">$siteurl</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$currenthost</span><span class=\"token operator\">.</span><span class=\"token variable\">$currentpath</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Define them to be used in Wordpress</span>\r\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WP_HOME'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$siteurl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WP_SITEURL'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$siteurl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WP_CONTENT_URL'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$siteurl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/wp-content'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WP_PLUGIN_URL'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$siteurl</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/wp-content/plugins'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'DOMAIN_CURRENT_SITE'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$siteurl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n@<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'ADMIN_COOKIE_PATH'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'./'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It uses PHP's functionality to get server and execution environment information with <code class=\"language-text\">$_SERVER['SERVER_ADDR']</code>, like for example the server's IP address.\r\nThen with <code class=\"language-text\">$_SERVER['SCRIPT_NAME']</code> we get the current script's full path and filename.</p>\n<p>Explanations for the Regexes:</p>\n<ul>\n<li><code class=\"language-text\">@/+$@</code> is used to strip the file name from the path</li>\n<li><code class=\"language-text\">/\\/wp.+/</code> is used to strip the wordpress folder names from the path, for example wp-admin</li>\n</ul>\n<p>The <code class=\"language-text\">$currentpath</code> is relevant if you want to install Wordpress in a sub folder. Without it you wouldn't get the folder added to the path, which would result in the URL being just the IP, which isn't enough for the URL to work.</p>\n<p>Then we can add the cleaned IP to the Wordpress's constants that handle the site URL in the wp-config file. And thus we have setup Wordpress to use a dynamic server IP address!</p>\n<p>I have also implemented this snippet into this <a href=\"/blog/projects/vagrant-cli-tool/\">automation tool for making new Vagrant VMs</a>, which I use for Wordpress development.</p>","frontmatter":{"title":"Dynamic Wordpress siteurl","date":"January 10, 2021","update":null,"description":null}},"morePosts":{"nodes":[{"fields":{"slug":"/blog/ideas/plotting-the-mandelbrot-set/"},"frontmatter":{"title":"Plotting the Mandelbrot set"}},{"fields":{"slug":"/blog/projects/mandelbrot-set-visualizer/"},"frontmatter":{"title":"Mandelbrot set visualizer"}},{"fields":{"slug":"/blog/projects/advent-of-code/"},"frontmatter":{"title":"Advent Of Code 2020"}},{"fields":{"slug":"/blog/projects/vagrant-cli-tool/"},"frontmatter":{"title":"Vagrant CLI tool"}},{"fields":{"slug":"/blog/projects/fruits/"},"frontmatter":{"title":"Fruits"}}]}},"pageContext":{"tags":["PHP","Wordpress"],"slug":"/blog/ideas/wordpress-dynamic-ip/","previous":{"fields":{"slug":"/blog/projects/advent-of-code/"},"frontmatter":{"title":"Advent Of Code 2020","tags":["Projects","Datastructures","Algorithms"],"date":"2020-12-27"}},"next":{"fields":{"slug":"/blog/projects/mandelbrot-set-visualizer/"},"frontmatter":{"title":"Mandelbrot set visualizer","tags":["Projects","Graphics Programming","Algorithms","JavaScript"],"date":"2021-02-28"}}}},"staticQueryHashes":["3000541721","3610821479","845761813"],"slicesMap":{}}